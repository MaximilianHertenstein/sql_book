#!/bin/bash
set -euo pipefail

# Simplified postBuild: ensure MySQL client/server use /tmp/mysql.sock
CFG=/etc/mysql/my.cnf
echo "Ensuring MySQL socket config in $CFG"
if [ ! -f "$CFG" ]; then
  touch "$CFG"
fi

# If the socket line is not present, append the minimal config
if ! grep -q "socket=/tmp/mysql.sock" "$CFG" 2>/dev/null; then
  cat >> "$CFG" <<'EOF'

[server]
socket=/tmp/mysql.sock

[client]
socket=/tmp/mysql.sock
EOF
  echo "Appended socket config to $CFG"
else
  echo "Socket config already present in $CFG"
fi

echo "postBuild done. This script no longer starts mysqld or creates databases. Start the server in the session with start_mysql.sh."
  echo "Creating database and example user (using conda mysqld)"
